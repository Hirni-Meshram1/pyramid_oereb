## -*- coding: utf-8 -*-
<?xml version="1.0" encoding="UTF-8" ?>
<GetExtractByIdResponse xmlns:xsd="http://www.w3.org/2001/XMLSchema"
                        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                        xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/Extract"
                        xmlns:data="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData"
                        xmlns:gml="http://www.opengis.net/gml/3.2">
<%
    from pyramid_oereb.lib.records.plr import PlrRecord
    from pyramid_oereb import Config, route_prefix
%>
<%
    def parse_bool(expression):
        if expression:
            return 'true'
        else:
            return 'false'
%>
    %if params.flavour == 'embeddable':
    <embeddable>
        <cadasterState>${str(extract.embeddable.cadaster_state)}</cadasterState>
        <cadasterOrganisationName>${localized(extract.embeddable.cadaster_organisation.name).get('Text')}</cadasterOrganisationName>
        <dataOwnerNameCadastralSurveying>${localized(extract.embeddable.data_owner_cadastral_surveying.name).get('Text')}</dataOwnerNameCadastralSurveying>
        <transferFromSourceCadastralSurveying>${extract.embeddable.transfer_from_source_cadastral_surveying.strftime('%d-%m-%YT%H:%M:%S')}</transferFromSourceCadastralSurveying>
        % for datasource in extract.embeddable.datasources:
        <%include file="data_source.xml" args="datasource=datasource"/>
        % endfor
    </embeddable>
    %endif
    <Extract>
        <CreationDate xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${extract.creation_date}
        </CreationDate>
    %if extract.electronic_signature:
        <Signiture xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${extract.electronic_signature}
        </Signiture>
    %endif
    %if extract.concerned_theme:
        %for theme in extract.concerned_theme:
        <ConcernedTheme xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            <%include file="theme.xml" args="theme=theme"/>
        </ConcernedTheme>
        %endfor
    %endif
    %if extract.not_concerned_theme:
        %for theme in extract.not_concerned_theme:
        <NotConcernedTheme xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            <%include file="theme.xml" args="theme=theme"/>
        </NotConcernedTheme>
        %endfor
    %endif
    %if extract.theme_without_data:
        %for theme in extract.theme_without_data:
        <ThemeWithoutData xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            <%include file="theme.xml" args="theme=theme"/>
        </ThemeWithoutData>
        %endfor
    %endif
        <isReduced xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${parse_bool(params.flavour == 'reduced')}
        </isReduced>
    %if params.images:
        <LogoPLRCadastre xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${extract.logo_plr_cadastre.encode()}
        </LogoPLRCadastre>
        <FederalLogo xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${extract.federal_logo.encode()}
        </FederalLogo>
        <CantonalLogo xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${extract.cantonal_logo.encode()}
        </CantonalLogo>
        <MunicipalityLogo xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${extract.municipality_logo.encode()}
        </MunicipalityLogo>
    %else:
        <LogoPLRCadastreRef xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${request.route_url('{0}/image/logo'.format(route_prefix), logo='oereb')}
        </LogoPLRCadastreRef>
        <FederalLogoRef xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${request.route_url('{0}/image/logo'.format(route_prefix), logo='confederation')}
        </FederalLogoRef>
        <CantonalLogoRef xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${request.route_url('{0}/image/logo'.format(route_prefix), logo='canton')}
        </CantonalLogoRef>
        <MunicipalityLogoRef xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${request.route_url('{0}/image/municipality'.format(route_prefix), fosnr=extract.real_estate.fosnr)}
        </MunicipalityLogoRef>
    %endif
        <ExtractIdentifier xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${extract.extract_identifier}
        </ExtractIdentifier>
    %if extract.qr_code:
        <QRCode xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            ${extract.qr_code}
        </QRCode>
    %endif
    % if extract.general_information:
        <GeneralInformation>
            <%include file="multilingual_m_text.xml" args="text=extract.general_information"/>
        </GeneralInformation>
    %endif
        <BaseData xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            <%include file="multilingual_m_text.xml" args="text=extract.base_data"/>
        </BaseData>
        %for glossary in extract.glossaries:
        <%include file="glossary.xml" args="glossary=glossary"/>
        %endfor
        <%include file="real_estate.xml" args="real_estate=extract.real_estate"/>
        %for exclusion_of_liability in extract.exclusions_of_liability:
        <%include file="exclusion_of_liability.xml" args="exclusion_of_liability=exclusion_of_liability"/>
        %endfor
        <PLRCadastreAuthority xmlns="http://schemas.geo.admin.ch/V_D/OeREB/1.0/ExtractData">
            <%include file="office.xml" args="office=extract.plr_cadastre_authority"/>
        </PLRCadastreAuthority>
    </Extract>
</GetExtractByIdResponse>